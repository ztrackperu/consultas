use("intranet")
//db.cabeot.find({c_numot:1000028211})
//db.detaot.find({c_numot:1000028211})
//explain()
//explain("executionStats")
db.cabeot.aggregate([
    {$project:{_id:0,}},
    {$match: {c_numot: 1000028211}},  
    {
        $lookup: {
          from: 'detaot',
          localField: 'c_numot',
          foreignField: 'c_numot',
          as: 'DetalleOt',
          pipeline: [
           {
            $project:{_id:0}
           } ,
           {
            $lookup: {
                from: 'notmae',
                localField: 'c_numot',
                foreignField: 'c_NumOT',
                as: 'NotaSalida',
                pipeline: [
                 {
                  $project:{_id:0}
                 } ,
                 {
                    $lookup: {
                        from: 'notmov',
                        localField: 'NT_NDOC',
                        foreignField: 'NT_NDOC',
                        as: 'NotaSalidaDetalle',
                        pipeline: [
                            {
                             $project:{_id:0}
                            },
                            {
                                $lookup: {
                                    from: 'invmae',
                                    localField: 'NT_CART',
                                    foreignField: 'IN_CODI',
                                    as: 'DetalleInsumo',
                                    pipeline: [
                                        {
                                            $project:{
                                                _id:0, 
                                                IN_ARTI:1,
                                                IN_UVTA:1,
                                                IN_COST:1
                                            }
                                        },
                                        
                                       ]
                                }
                            }
                           ]
                    }
    
                 }
    
                ],
    
    
              },
        }
          ]
        }
    },   
])
